mintStart:
  handler: asset/minting.mintStart
  memorySize: 128
  timeout: 60
  iamRoleStatementsName: ${self:service}-${opt:stage, self:provider.stage}-mintStart-role
  iamRoleStatements:
    - Effect: Allow
      Action:
        - dynamodb:DescribeTable
        - dynamodb:GetItem
      Resource: 
        - "arn:aws:dynamodb:us-east-1:*:table/${self:provider.environment.DYNAMODB_TABLE_DEVELOPER_CONTRACT}"
    - Effect: Allow
      Action:
        - dynamodb:DescribeTable
        - dynamodb:GetItem
      Resource: 
        - "arn:aws:dynamodb:${self:provider.region}:*:table/${self:provider.environment.DYNAMODB_TABLE_PACKS}"
assetMetaData:
  handler: asset/minting.assetMetaData
  memorySize: 128
  timeout: 60
  iamRoleStatementsName: ${self:service}-${opt:stage, self:provider.stage}-assetMetaData-role
  iamRoleStatements:
    - Effect: "Allow"
      Action:
        - s3:GetObject
        - s3:PutObject
      Resource: 
        - "arn:aws:s3:::${opt:stage, self:provider.stage}:${self:provider.environment.ASSET_UPLOAD_BUCKET}/*"
    - Effect: Allow
      Action:
        - dynamodb:DescribeTable
        - dynamodb:GetItem
        - dynamodb:UpdateItem
      Resource: 
        - "arn:aws:dynamodb:us-east-1:*:table/${self:provider.environment.DYNAMODB_TABLE_DEVELOPER_CONTRACT}"
    - Effect: Allow
      Action:
        - dynamodb:DescribeTable
        - dynamodb:GetItem
      Resource: 
        - "arn:aws:dynamodb:us-east-1:*:table/${self:provider.environment.DYNAMODB_TABLE_DEVELOPER_MINT}"
mintAssetEstimateFees:
  handler: asset/minting.estimateFees
  memorySize: 256
  timeout: 180
  iamRoleStatementsName: ${self:service}-${opt:stage, self:provider.stage}-mintAssetEstimateFees-role
  iamRoleStatements:
    - Effect: Allow
      Action:
        - dynamodb:DescribeTable
        - dynamodb:GetItem
      Resource: 
        - "arn:aws:dynamodb:us-east-1:*:table/${self:provider.environment.DYNAMODB_TABLE_DEVELOPER_CONTRACT}"
    - Effect: Allow
      Action:
        - dynamodb:DescribeTable
        - dynamodb:GetItem
      Resource: 
        - "arn:aws:dynamodb:${self:provider.region}:*:table/${self:provider.environment.DYNAMODB_TABLE_PACKS}"
mintAsset:
  handler: asset/minting.mint
  memorySize: 256
  timeout: 900
  iamRoleStatementsName: ${self:service}-${opt:stage, self:provider.stage}-mintAsset-role
  iamRoleStatements:
    - Effect: Allow
      Action:
        - dynamodb:DescribeTable
        - dynamodb:GetItem
      Resource: 
        - "arn:aws:dynamodb:us-east-1:*:table/${self:provider.environment.DYNAMODB_TABLE_DEVELOPER_CONTRACT}"
    - Effect: Allow
      Action:
        - dynamodb:DescribeTable
        - dynamodb:GetItem
      Resource: 
        - "arn:aws:dynamodb:${self:provider.region}:*:table/${self:provider.environment.DYNAMODB_TABLE_PACKS}" 
    - Effect: Allow
      Action:
        - dynamodb:DescribeTable
        - dynamodb:GetItem
        - dynamodb:UpdateItem
      Resource: 
        - "arn:aws:dynamodb:us-east-1:*:table/${self:provider.environment.DYNAMODB_TABLE_DEVELOPER_MINT}"
  environment:
      table_region: us-east-1      
mintAssetStop:
  handler: asset/minting.stop
mintTest:
  handler: asset/minting.estimateFees
  memorySize: 256
  timeout: 300
  iamRoleStatementsName: ${self:service}-${opt:stage, self:provider.stage}-mintTest-role
  iamRoleStatements:
    - Effect: Allow
      Action:
        - dynamodb:DescribeTable
        - dynamodb:GetItem
        - dynamodb:UpdateItem
      Resource: 
        - "arn:aws:dynamodb:us-east-1:*:table/${self:provider.environment.DYNAMODB_TABLE_DEVELOPER_MINT}"
    - Effect: "Allow"
      Action:
        - s3:GetObject
        - s3:PutObject
      Resource: 
        - "arn:aws:s3:::${opt:stage, self:provider.stage}:${self:provider.environment.ASSET_UPLOAD_BUCKET}/*"
    - Effect: Allow
      Action:
        - dynamodb:DescribeTable
        - dynamodb:GetItem
        - dynamodb:UpdateItem
      Resource: 
        - "arn:aws:dynamodb:us-east-1:*:table/${self:provider.environment.DYNAMODB_TABLE_DEVELOPER_CONTRACT}"
    - Effect: Allow
      Action:
        - dynamodb:DescribeTable
        - dynamodb:GetItem
      Resource: 
        - "arn:aws:dynamodb:${self:provider.region}:*:table/${self:provider.environment.DYNAMODB_TABLE_PACKS}"
  environment:
    table_region: us-east-1 
  events:
    - http:
        path: asset/minting/estimate
        method: post 
        authorizer: aws_iam
        cors: true